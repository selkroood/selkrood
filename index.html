<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>SHÎ”DÃ˜W V64 | GitHub Pages Stable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        :root { --neon: #00ffcc; --dark: #05070a; }
        body { background: var(--dark); color: #e2e8f0; font-family: 'Consolas', monospace; }
        .cyber-panel { background: rgba(10, 15, 25, 0.9); border: 1px solid rgba(0, 255, 204, 0.1); }
        .terminal-log { height: 200px; overflow-y: auto; font-size: 11px; background: #000; padding: 10px; border-radius: 8px; border-left: 3px solid var(--neon); }
        .btn-action { background: var(--neon); color: #000; font-weight: 900; transition: 0.3s; cursor: pointer; }
        .btn-action:hover { background: #fff; box-shadow: 0 0 15px var(--neon); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto space-y-6">
        <header class="flex justify-between items-center border-b border-white/10 pb-4">
            <div>
                <h1 class="text-3xl font-black italic text-white tracking-tighter">SHÎ”DÃ˜W <span class="text-[#00ffcc]">V64</span></h1>
                <p class="text-[10px] opacity-50 uppercase tracking-widest text-blue-400 font-bold">Stable Version 5.0 - GitHub Pages</p>
            </div>
            <div class="bg-white/5 p-2 rounded px-6 text-center border-t-2 border-[#00ffcc]">
                <div id="total-count" class="text-2xl font-bold text-[#00ffcc]">0</div>
                <div class="text-[9px] opacity-50 uppercase">TOTAL DATABASE RECORDS</div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <aside class="space-y-4">
                <div class="cyber-panel p-4 rounded-xl space-y-3">
                    <label class="btn-action w-full flex items-center justify-center p-3 rounded-lg text-sm">
                        ğŸ“ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª
                        <input type="file" id="fileInput" multiple class="hidden">
                    </label>
                    <button id="btnStats" class="w-full p-2 text-xs border border-white/10 rounded hover:bg-[#00ffcc]/10">ğŸ“Š ØªØ­Ù„ÙŠÙ„ ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                    <button id="btnClear" class="w-full p-2 text-[10px] text-red-500 opacity-60 hover:opacity-100 font-bold">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
                </div>
                <div id="terminal" class="terminal-log">
                    <div class="text-blue-400 font-bold">[READY] Core system synced at Version 5.</div>
                </div>
            </aside>

            <main class="lg:col-span-3">
                <div class="cyber-panel p-6 rounded-xl min-h-[500px] flex flex-col">
                    <div id="display-area" class="flex-grow overflow-y-auto pr-2 space-y-2 text-xs">
                        <div class="opacity-20 italic text-center mt-20">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const UI = {
            log: (msg, color = "#00ffcc") => {
                const term = document.getElementById('terminal');
                term.innerHTML += `<div style="color:${color}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
                term.scrollTop = term.scrollHeight;
            },
            updateCount: (c) => document.getElementById('total-count').innerText = c.toLocaleString()
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù€ Worker Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        const worker = new Worker('worker.js');
        let db = null;

        // ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø®ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ù†ÙØ³ Ø§Ù„Ø¥ØµØ¯Ø§Ø± (5)
        const initDB = () => {
            const req = indexedDB.open("SHADOW_ENGINE", 5);
            
            req.onupgradeneeded = (e) => {
                const database = e.target.result;
                if (!database.objectStoreNames.contains("vault")) {
                    database.createObjectStore("vault", { autoIncrement: true });
                    UI.log("Object store 'vault' initialized.");
                }
            };

            req.onsuccess = (e) => {
                db = e.target.result;
                refreshCounter();
            };
        };

        const refreshCounter = () => {
            if (!db) return;
            const tx = db.transaction("vault", "readonly");
            const req = tx.objectStore("vault").count();
            req.onsuccess = () => UI.updateCount(req.result);
        };

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ù€ Worker
        worker.onmessage = (e) => {
            const data = e.data;
            if (data.type === 'PROGRESS') {
                refreshCounter();
            } else if (data.type === 'COMPLETE') {
                UI.log(`ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…`, "white");
                refreshCounter();
            } else if (data.type === 'ERROR') {
                UI.log(`ERROR: ${data.message}`, "red");
            }
        };

        document.getElementById('fileInput').onchange = (e) => {
            for (const file of e.target.files) {
                UI.log(`Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ ${file.name} Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø±Ùƒ...`, "#aaa");
                worker.postMessage({ file });
            }
        };

        document.getElementById('btnStats').onclick = () => {
            if (!db) return;
            UI.log("Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ØµØ±ÙŠ...");
            const stats = { total: 0, domains: {} };
            const tx = db.transaction("vault", "readonly");
            const store = tx.objectStore("vault");
            
            store.openCursor().onsuccess = (event) => {
                const cursor = event.target.result;
                if (cursor) {
                    stats.total++;
                    const d = cursor.value.domain;
                    stats.domains[d] = (stats.domains[d] || 0) + 1;
                    cursor.continue();
                } else {
                    renderStats(stats);
                }
            };
        };

        function renderStats(data) {
            const top10 = Object.entries(data.domains).sort((a,b) => b[1]-a[1]).slice(0, 10);
            let html = `<div class="p-4 bg-white/5 rounded-lg border border-white/10 shadow-xl">
                        <h2 class="text-[#00ffcc] font-black mb-4 italic">TOP 10 DOMAIN ANALYTICS</h2>`;
            top10.forEach(([name, count]) => {
                const pc = ((count / data.total) * 100).toFixed(1);
                html += `<div class="flex justify-between border-b border-white/5 py-2 text-[11px]">
                            <span class="opacity-80">${name}</span>
                            <span class="text-[#00ffcc] font-bold">${pc}% (${count})</span>
                         </div>`;
            });
            document.getElementById('display-area').innerHTML = html + `</div>`;
        }

        document.getElementById('btnClear').onclick = () => {
            if (!db) return;
            const tx = db.transaction("vault", "readwrite");
            tx.objectStore("vault").clear().onsuccess = () => {
                UI.updateCount(0);
                UI.log("ØªÙ… ØªØµÙÙŠØ± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.", "red");
                document.getElementById('display-area').innerHTML = "";
            };
        };

        window.onload = initDB;
    </script>
</body>
</html>
